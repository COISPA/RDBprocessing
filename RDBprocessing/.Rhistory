library(knitr)
library(tidyr)
path <- paste("C:\\Users\\Bitetto Isabella\\OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L\\MARE22\\STREAM\\FINAL REVISION OF DELIVERABLES\\SDEF_to_DG_MARE_MedBS", sep="")
setwd(path)
knitr::opts_knit$set(root.dir = path)
#R general option:
options(stringsAsFactors = FALSE)
options(warn=0)
#chunk option
knitr::opts_chunk$set(cache=TRUE,echo=TRUE, warning=FALSE,
message=FALSE, fig.height=6,progress=FALSE,verbose=FALSE,
include=TRUE,dev='png',autodep=FALSE)
#load packages
library(COSTcore)
library(COSTeda)
library(COSTdbe)
library(knitr)
library(tidyr)
install.packages("tidyr")
install.packages("tidyr")
install.packages("tidyr")
path <- paste("C:\\Users\\Bitetto Isabella\\OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L\\MARE22\\STREAM\\FINAL REVISION OF DELIVERABLES\\SDEF_to_DG_MARE_MedBS", sep="")
setwd(path)
knitr::opts_knit$set(root.dir = path)
#R general option:
options(stringsAsFactors = FALSE)
options(warn=0)
#chunk option
knitr::opts_chunk$set(cache=TRUE,echo=TRUE, warning=FALSE,
message=FALSE, fig.height=6,progress=FALSE,verbose=FALSE,
include=TRUE,dev='png',autodep=FALSE)
#load packages
library(COSTcore)
library(COSTeda)
library(COSTdbe)
library(knitr)
library(tidyr)
.libPaths()
install.packages("rlang")
install.packages("rlang")
library(COSTcore)
install.packages("C:/Users/Bitetto Isabella/OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L/RDB Anneex 4a/RDBprocess/Task 3.2/SDEF_to_DG_MARE_MedBS/COSTcore_1.4-0.zip", repos = NULL, type = "win.binary")
install.packages("C:/Users/Bitetto Isabella/OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L/RDB Anneex 4a/RDBprocess/Task 3.2/SDEF_to_DG_MARE_MedBS/COSTdbe_1.4-1.zip", repos = NULL, type = "win.binary")
install.packages("C:/Users/Bitetto Isabella/OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L/RDB Anneex 4a/RDBprocess/Task 3.2/SDEF_to_DG_MARE_MedBS/COSTeda_1.4.0.zip", repos = NULL, type = "win.binary")
library(COSTcore)
library(COSTeda)
library(COSTdbe)
library(knitr)
library(tidyr)
install.packages("tidyselect")
install.packages("tidyselect")
load("C:/RDBprocessing/data/data_ex.rda")
data=data_ex
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE","PRM","METHOD_USED")
head(data_ex)
aggregate(data$Number_at_length,by=list("Flag_country", "Year","Area", "Species","Sex","Length_class"),FUN="sum")
data$Number_at_length
?aggregate
aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species,data$Sex,data$Length_class),FUN="sum")
imm=c("1","2","2a")
data$mat=ifelse(data$Maturity_Stage %in$ imm,0,1)
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
head(data)
data=data[-c(NA,-1,0),]
unique(data$Maturity_Stage)
data=data_ex
unique(data$Maturity_Stage)
data=data[data$Maturity_Stage %in%-c(NA,-1,0,""),]
data=data[-data$Maturity_Stage %in%c(NA,-1,0,""),]
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
unique(data$Maturity_Stage)
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species,data$Sex,data$Length_class,data$mat),FUN="sum")
matrix
colnmaes(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","mat","SAMPLE_SIZE")
colnames(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","mat","SAMPLE_SIZE")
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species,data$Sex,data$Length_class,data$mat,data$Length_code),FUN="sum")
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species,data$Sex,data$Length_class,data$mat,data$Length_code),FUN="sum")
colnames(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","mat","UNIT","SAMPLE_SIZE")
head(matrix)
head(data_ex)
spe_tab=read.table("C:\\Users\\Bitetto Isabella\\OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L\\RDB Anneex 4a\\RDBprocess\\3alpha code_2020.csv",sep=";",header=T)
spe_tab=read.csv("C:\\Users\\Bitetto Isabella\\OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L\\RDB Anneex 4a\\RDBprocess\\3alpha code_2020.csv",sep=";",header=T)
head(spe_tab)
Annex17=read.csv("C:\\Users\\Bitetto Isabella\\OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L\\RDB Anneex 4a\\RDBprocess\\SPECIE ANNEX 1.7.csv")
Annex17
Annex17=read.csv2("C:\\Users\\Bitetto Isabella\\OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L\\RDB Anneex 4a\\RDBprocess\\SPECIE ANNEX 1.7.csv")
Annex17
?merge
Annex17=read.csv2("C:\\Users\\Bitetto Isabella\\OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L\\RDB Anneex 4a\\RDBprocess\\SPECIE ANNEX 1.7.csv",header=F)
Annex17
colnames(Annex17)=c("Species","")
merge(Annex17,spe_tab,by.x="Species",by.y="X3A_CODE",all.y=T)
head(spe_tab)
colnames(spe_tab)
merge(Annex17,spe_tab,by.x="Species",by.y="X3A_CODE",all.y=TRUE)
merge(Annex17,spe_tab,by.x="Species",by.y="X3A_CODE")
mm=merge(Annex17,spe_tab,by.x="Species",by.y="X3A_CODE")
head(mm)
write.table(mm,"mm.csv",sep=";", row.names=F)
getwd()
save(mm[,c(1,5)],file="data/Annex17.rda",compress="xz",compression_level=9)
mm[,c(1,5)]
mm=merge(Annex17,spe_tab,by.x="Species",by.y="X3A_CODE")[,c(1,5)]
save("mm",file="data/Annex17.rda",compress="xz",compression_level=9)
mm
roxygen2::roxigenise
data2=merge(data,mm,by="Species")
head(data2)
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
data2
unique(data2$Species.y)
data=data2[,-which(is.na(data2$Species.y))]
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Sex,data$Length_class,data$mat,data$Length_code),FUN="sum")
data=data_ex
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
data=data2[,-which(is.na(data2$Species.y))]
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Sex,data$Length_class,data$mat,data$Length_code),FUN="sum")
data$Species.y
data
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
data2$Species.y
data=data2[-which(is.na(data2$Species.y)),]
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Sex,data$Length_class,data$mat,data$Length_code),FUN="sum")
data
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
head(data2)
data=data_ex
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
head(data2)
which(is.na(data2$Species.y))
data=data2[-which(is.na(data2$Species.y)),]
data
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
data2
data=data_ex
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
data2$Species.y
is.na(data2$Species.y)
which(is.na(data2$Species.y))
data2[-which(is.na(data2$Species.y)),]
is.na(data2$Species.y)
data=data_ex
load("C:/RDBprocessing/data/data_ex.rda")
data=data_ex
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
imm=c("1","2","2a")
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
load("C:/RDBprocessing/data/Annex17.rda")
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
data2[-which(is.na(data2$Species.y)),]
colnames(data2)
data2$Species.y
data2[-which(is.na(as.character(data2$Species.y))),]
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
as.character(data2$Species.y)
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
data2
data=data_ex
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,mm,by.x="Species",by.y="Scientific_name")
data2
as.character(data2$Species.y)
data2[-which(as.character(data2$Species.y)!=""),]
data2[-which(as.character(data2$Species.y)==""),]
as.character(data2$Species.y)=="")
which(as.character(data2$Species.y)=="")
data=data2 #[-which(as.character(data2$Species.y)==""),]
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Sex,data$Length_class,data$mat,data$Length_code),FUN="sum")
colnames(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","mat","UNIT","SAMPLE_SIZE")
matrix
write.table(mm,"Annex17.csv",sep?";".row.names=F)
write.table(mm,"Annex17.csv",sep=";".row.names=F)
write.table(mm,"Annex17.csv",sep=";,row.names=F)
write.table(mm,"Annex17.csv",sep=";",row.names=F)
matrix$mat==0,]
matrix[matrix$mat==0,]
merge(matrix[matrix$mat==0,],matrix[matrix$mat==1,],by=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE") )
immat=matrix[matrix$mat==0,]
mat=matrix[matrix$mat==1,]
merge(immat,mat,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE") )
immat
merge(immat,mat,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS") )
merge(immat,mat,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","UNIT") )
tab1=tab1[,c(1:7,9,11)]
tab1=merge(immat,mat,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","UNIT") )
tab1=tab1[,c(1:7,9,11)]
tab1
colnames(tab1)[8,9]=c("imm","mat")
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Sex,data$Length_class,data$mat,data$Length_code),FUN="sum")
colnames(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","mat","UNIT","SAMPLE_SIZE")
immat=matrix[matrix$mat==0,]
mat=matrix[matrix$mat==1,]
tab1=merge(immat,mat,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","UNIT") )
tab1=tab1[,c(1:7,9,11)]
colnames(tab1)[8,9]=c("imm","mat")
tab1
colnames(tab1)[c(8,9)]=c("imm","mat")
tab1
Annex17=read.csv2("C:\\Users\\Bitetto Isabella\\OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L\\RDB Anneex 4a\\RDBprocess\\Annex17 con unit.csv",header=F)
save("Annex17",file="data/Annex17.rda",compress="xz",compression_level=9)
Annex17
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,Annex17,by.x="Species",by.y="Scientific_name")
Annex17=read.csv2("C:\\Users\\Bitetto Isabella\\OneDrive - Coispa Tecnologia & Ricerca S.C.A.R.L\\RDB Anneex 4a\\RDBprocess\\Annex17 con unit.csv",header=T)
save("Annex17",file="data/Annex17.rda",compress="xz",compression_level=9)
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,Annex17,by.x="Species",by.y="Scientific_name")
Annex17
data=data_ex
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","LENGTHCLASS","UNIT","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in%c(NA,-1,0,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,Annex17,by.x="Species",by.y="Scientific_name")
data=data2 #[-which(as.character(data2$Species.y)==""),]
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Sex,data$Length_class,data$mat,data$Length_code),FUN="sum")
colnames(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","mat","UNIT","SAMPLE_SIZE")
immat=matrix[matrix$mat==0,]
mat=matrix[matrix$mat==1,]
tab1=merge(immat,mat,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","LENGTHCLASS","UNIT") )
tab1=tab1[,c(1:7,9,11)]
colnames(tab1)[c(8,9)]=c("imm","mat")
tab1
merge(tab1,Annex17,by=SPECIES)
tab1
merge(tab1,Annex17,by.x=SPECIES",by.y="Species")
tab1$LENGTHCLASS=ifelse(tab1)
ML=matrix[,c(1,3,2,2,4,5,6,)]
}
merge(tab1,Annex17,by.x="SPECIES",by.y="Species")
tab1$LENGTHCLASS=ifelse(tab1$UNIT.y==cm,tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
tab1$LENGTHCLASS=ifelse(as.character(tab1$UNIT.y)=="cm",tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
tab1$LENGTHCLASS
as.character(tab1$UNIT.y)
tab1$LENGTHCLASS=ifelse(tab1[$UNIT.y)[,11]=="cm",tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
ML=matrix[,c(1,3,2,2,4,5,6,)]
}
tab1$LENGTHCLASS=ifelse(tab1$UNIT.y[,11]=="cm",tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
tab1$LENGTHCLASS=ifelse(tab1[,11]=="cm",tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
tab1[,11]
tab1=merge(tab1,Annex17,by.x="SPECIES",by.y="Species")
tab1$LENGTHCLASS=ifelse(tab1[,11]=="cm",tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
tab1
tab1$LENGTHCLASS=trunc(tab1$LENGTHCLASS)
tab1
colnames(tab1)[11]="UNIT"
tab1=aggregate(c(tab1$imm,tab1$mat),by=list(tab1$SPECIES,tab1$COUNTRY, tab1$START_YEAR, tab1$AREA, tab1$SEX, tab1$LENGTHCLASS,tab1$UNIT),FUN="sum")
tab1=aggregate(c(tab1[,c(8,9)]),by=list(tab1$SPECIES,tab1$COUNTRY, tab1$START_YEAR, tab1$AREA, tab1$SEX, tab1$LENGTHCLASS,tab1$UNIT),FUN="sum")
tab1
colnames(tab1)=c("SPECIES","COUNTRY","START_YEAR","AREA","SEX","LENGTHCLASS","UNIT")
tab1
colnames(tab1)=c("SPECIES","COUNTRY","START_YEAR","AREA","SEX","LENGTHCLASS","UNIT","imm","mat")
tab1$PRM=tab1$mat/(tab1$imm+tab$mat)
tab1$PRM=tab1$mat/(tab1$imm+tab1$mat)
tab1$SAMPLE_SIZE=(tab1$imm+tab1$mat)
tab1
ML=tab1[,c(2,4,3,3,1,5,6,7,11,10)]
ML$METHOD_USED="Observed proportions (immatures 1,2,2a)"
ML
colnames(ML)[4]="END_YEAR"
length("Observed proportions (immatures 1,2,2a)")
length_str("Observed proportions (immatures 1,2,2a)")
str_length("Observed proportions (immatures 1,2,2a)")
library(stringr)
str_length("Observed proportions (immatures 1,2,2a)")
library(roxygen2)
roxygenize()
library(RDBprocessing)
data_ex
save("data_ex",file="data/data_ex.rda",compress="xz",compression_level=9)
ML_MEDBS(data=RDBprocessing::data_ex)
ML_MEDBS(data=RDBprocessing::data_ex)
ML_MEDBS(data=RDBprocessing::data_ex)
library(RDBprocessing)
library(RDBprocessing)
ML_MEDBS(data=RDBprocessing::data_ex)
roxygenise()
library(roxygen2)
roxygenise()
load("C:/RDBprocessing/RDBprocessing/data/data_ex.rda")
load("C:/RDBprocessing/RDBprocessing/data/Annex17.rda")
ML_MEDBS(data=RDBprocessing::data_ex)
library(RDBprocessing)
library(RDBprocessing)
data_ex
RDBprocessing::data_ex
data("data_ex")
library(RDBprocessing)
RDBprocessing::Annex17
library(devtools)
devtools::document()
library(RDBprocessing)
RDBprocessing::Annex17
RDBprocessing::data_ex
roxygenise()
library(roxygen2)
roxygenise()
roxygenise()
library(RDBprocessing)
library(devtools)
RDBprocessing::data_ex
data(data_ex)
data(data_ex)
library(RDBprocessing)
RDBprocessing::data_exdata_ex
data_ex
data=data_ex
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","LENGTHCLASS","UNIT","SEX_RATIO","COMMENTS")
data=data[-which(data$Sex %in%c(NA,-1,0,"","U","C","N","I")),]
data$fem=ifelse(data$Sex== "F",1,0)
data2=merge(data,RDBprocessing::Annex17,by.x="Species",by.y="Scientific_name")
data=data2 #[-which(as.character(data2$Species.y)==""),]
Annex17
library(RDBprocessing)
Annex17
RDBprocessing::Annex1
RDBprocessing::Annex17
load("C:/RDBprocessing/RDBprocessing/data/Annex17.rda")
Annex17
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","LENGTHCLASS","UNIT","SEX_RATIO","COMMENTS")
data=data[-which(data$Sex %in%c(NA,-1,0,"","U","C","N","I")),]
data$fem=ifelse(data$Sex== "F",1,0)
data2=merge(data,RDBprocessing::Annex17,by.x="Species",by.y="Scientific_name")
data=data2 #[-which(as.character(data2$Species.y)==""),]
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Length_class,data$fem,data$Length_code),FUN="sum")
data2=merge(data,Annex17,by.x="Species",by.y="Scientific_name") #RDBprocessing::
data=data2 #[-which(as.character(data2$Species.y)==""),]
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Length_class,data$fem,data$Length_code),FUN="sum")
data
data_ex
data=data_ex
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","LENGTHCLASS","UNIT","SEX_RATIO","COMMENTS")
data=data[-which(data$Sex %in%c(NA,-1,0,"","U","C","N","I")),]
data
data$fem=ifelse(data$Sex== "F",1,0)
data
Annex17
data2=merge(data,Annex17,by.x="Species",by.y="Scientific_name") #RDBprocessing::
data2
data=data2 #[-which(as.character(data2$Species.y)==""),]
data$Flag_country
data$Year
data$Species.y
data$fem
data$Length_code
data$Number_at_length
aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Length_class,data$fem,data$Length_code),FUN="sum")
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Length_class,data$fem,data$Length_code),FUN="sum")
matrix
colnames(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","LENGTHCLASS","fem","UNIT","SAMPLE_SIZE")
immat=matrix[matrix$fem==1,]
mat=matrix[matrix$mal==0,]
fem=matrix[matrix$fem==1,]
mal=matrix[matrix$mal==0,]
tab1=merge(fem,mal,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","LENGTHCLASS","UNIT") )
tab1
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Length_class,data$fem,data$Length_code),FUN="sum")
colnames(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","LENGTHCLASS","fem","UNIT","SAMPLE_SIZE")
fem=matrix[matrix$fem==1,]
mal=matrix[matrix$fem==0,]
tab1=merge(fem,mal,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","LENGTHCLASS","UNIT") )
tab1
tab1=tab1[,c(1:6,8,10)]
colnames(tab1)[c(7,8)]=c("fem","mal")
tab1=merge(tab1,Annex17,by.x="SPECIES",by.y="Species") #RDBprocessing::
tab1
tab1$LENGTHCLASS=ifelse(tab1[,10]=="cm",tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
tab1$LENGTHCLASS=trunc(tab1$LENGTHCLASS)
colnames(tab1)[10]="UNIT"
tab1=aggregate(c(tab1[,c(7,8)]),by=list(tab1$SPECIES,tab1$COUNTRY, tab1$START_YEAR, tab1$AREA, tab1$LENGTHCLASS,tab1$UNIT),FUN="sum")
colnames(tab1)=c("SPECIES","COUNTRY","START_YEAR","AREA","LENGTHCLASS","UNIT","fem","mal")
tab1$SEX_RATIO=tab1$fem/(tab1$fem+tab1$mal)
tab1$SEX_RATIO=tab1$fem/(tab1$fem+tab1$mal)
tab1
SRL=tab1[,c(2,4,3,3,1,5,6,9)]
ML$COMMENTS="Observed F/(F+M)"
colnames(SRL)[4]="END_YEAR"
SRL$COMMENTS="Observed F/(F+M)"
SRL
roxygenise()
data_ex
unique(data$Age)
which(data$Maturity_Stage %in% c(NA,-1,0,"") & data$Age %in% c(NA,-1,""))
library(RDBprocessing)
data=data_ex
Annex17
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","AGECLASS","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in% c(NA,-1,0,"") | data$Age %in% c(NA,-1,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
imm=c("1","2","2a")
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","AGECLASS","SAMPLE_SIZE","PRM","METHOD_USED")
data=data[-which(data$Maturity_Stage %in% c(NA,-1,0,"") | data$Age %in% c(NA,-1,"")),]
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data2=merge(data,RDBprocessing::Annex17,by.x="Species",by.y="Scientific_name")
data=data2 #[-which(as.character(data2$Species.y)==""),]
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Sex,data$Age,data$mat),FUN="sum")
data
data=data_ex
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","SEX","AGECLASS","SAMPLE_SIZE","PRM","METHOD_USED")
which(data$Maturity_Stage %in% c(NA,-1,0,"") | data$Age %in% c(NA,-1,""))
data[-which(data$Maturity_Stage %in% c(NA,-1,0,"") | data$Age %in% c(NA,-1,"")),]
data=data[-which(data$Maturity_Stage %in% c(NA,-1,0,"") | data$Age %in% c(NA,-1,"")),]
data
data$mat=ifelse(data$Maturity_Stage %in% imm,0,1)
data
data2=merge(data,RDBprocessing::Annex17,by.x="Species",by.y="Scientific_name")
data2
data=data2 #[-which(as.character(data2$Species.y)==""),]
data$Age
aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Sex,data$Age,data$mat),FUN="sum")
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Sex,data$Age,data$mat),FUN="sum")
colnames(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","AGECLASS","mat","SAMPLE_SIZE")
matrix
immat=matrix[matrix$mat==0,]
mat=matrix[matrix$mat==1,]
mat
merge(immat,mat,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","AGECLASS") )
tab1=merge(immat,mat,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","SEX","AGECLASS") )
tab1
tab1=tab1[,c(1:6,8,10)]
colnames(tab1)[c(7,8)]=c("imm","mat")
tab1=merge(tab1,RDBprocessing::Annex17,by.x="SPECIES",by.y="Species")
tab1
# tab1$LENGTHCLASS=ifelse(tab1[,11]=="cm",tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
tab1$AGECLASS=trunc(tab1$AGECLASS)
tab1=aggregate(c(tab1[,c(8,9)]),by=list(tab1$SPECIES,tab1$COUNTRY, tab1$START_YEAR, tab1$AREA, tab1$SEX, tab1$AGECLASS),FUN="sum")
tab1=aggregate(c(tab1[,c(7,8)]),by=list(tab1$SPECIES,tab1$COUNTRY, tab1$START_YEAR, tab1$AREA, tab1$SEX, tab1$AGECLASS),FUN="sum")
tab1
colnames(tab1)=c("SPECIES","COUNTRY","START_YEAR","AREA","SEX","AGECLASS","imm","mat")
tab1$PRM=tab1$mat/(tab1$imm+tab1$mat)
tab1$SAMPLE_SIZE=(tab1$imm+tab1$mat)
tab1
MA=tab1[,c(2,4,3,3,1,5,6,10,9)]
MA$METHOD_USED="Observed proportions (immatures 1,2,2a)"
colnames(MA)[4]="END_YEAR"
return(MA)
MA
data=data_ex
header=c("COUNTRY","AREA","START_YEAR","END_YEAR","SPECIES","AGECLASS","SEX_RATIO","COMMENTS")
data=data[-which(data$Sex %in%c(NA,-1,0,"","U","C","N","I") | data$Age %in% c(NA,-1,"")),]
data$fem=ifelse(data$Sex== "F",1,0)
data2=merge(data,RDBprocessing::Annex17,by.x="Species",by.y="Scientific_name") #
data=data2 #[-which(as.character(data2$Species.y)==""),]
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Age,data$fem),FUN="sum")
colnames(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","AGECLASS","fem","SAMPLE_SIZE")
fem=matrix[matrix$fem==1,]
mal=matrix[matrix$fem==0,]
tab1=merge(fem,mal,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","AGECLASS") )
tab1
tab1=tab1[,c(1:5,7,9)]
colnames(tab1)[c(6,7)]=c("fem","mal")
tab1=merge(tab1,RDBprocessing::Annex17,by.x="SPECIES",by.y="Species") #
#tab1$LENGTHCLASS=ifelse(tab1[,10]=="cm",tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
tab1$AGECLASS=trunc(tab1$AGECLASS)
matrix=aggregate(data$Number_at_length,by=list(data$Flag_country, data$Year,data$Area,data$Species.y,data$Age,data$fem),FUN="sum")
colnames(matrix)=c("COUNTRY", "START_YEAR","AREA","SPECIES","AGECLASS","fem","SAMPLE_SIZE")
fem=matrix[matrix$fem==1,]
mal=matrix[matrix$fem==0,]
tab1=merge(fem,mal,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","AGECLASS") )
tab1=tab1[,c(1:5,7,9)]
colnames(tab1)[c(6,7)]=c("fem","mal")
tab1=merge(tab1,RDBprocessing::Annex17,by.x="SPECIES",by.y="Species") #
#tab1$LENGTHCLASS=ifelse(tab1[,10]=="cm",tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
tab1$AGECLASS=trunc(tab1$AGECLASS)
#colnames(tab1)[10]="UNIT"
tab1=aggregate(c(tab1[,c(6,7)]),by=list(tab1$SPECIES,tab1$COUNTRY, tab1$START_YEAR, tab1$AREA, tab1$AGECLASS),FUN="sum")
colnames(tab1)=c("SPECIES","COUNTRY","START_YEAR","AREA","LENGTHCLASS","UNIT","fem","mal")
tab1$SEX_RATIO=tab1$fem/(tab1$fem+tab1$mal)
#tab1$SAMPLE_SIZE=(tab1$imm+tab1$mat)
colnames(tab1)=c("SPECIES","COUNTRY","START_YEAR","AREA","AGECLASS","fem","mal")
tab1=aggregate(c(tab1[,c(6,7)]),by=list(tab1$SPECIES,tab1$COUNTRY, tab1$START_YEAR, tab1$AREA, tab1$AGECLASS),FUN="sum")
colnames(tab1)=c("SPECIES","COUNTRY","START_YEAR","AREA","AGECLASS","fem","mal")
tab1$SEX_RATIO=tab1$fem/(tab1$fem+tab1$mal)
tab1=merge(fem,mal,by=c("COUNTRY", "START_YEAR","AREA","SPECIES","AGECLASS") )
tab1=tab1[,c(1:5,7,9)]
colnames(tab1)[c(6,7)]=c("fem","mal")
tab1=merge(tab1,RDBprocessing::Annex17,by.x="SPECIES",by.y="Species") #
#tab1$LENGTHCLASS=ifelse(tab1[,10]=="cm",tab1$LENGTHCLASS/10,tab1$LENGTHCLASS)
tab1$AGECLASS=trunc(tab1$AGECLASS)
#colnames(tab1)[10]="UNIT"
tab1=aggregate(c(tab1[,c(6,7)]),by=list(tab1$SPECIES,tab1$COUNTRY, tab1$START_YEAR, tab1$AREA, tab1$AGECLASS),FUN="sum")
colnames(tab1)=c("SPECIES","COUNTRY","START_YEAR","AREA","AGECLASS","fem","mal")
tab1$SEX_RATIO=tab1$fem/(tab1$fem+tab1$mal)
tab1
SRA=tab1[,c(2,4,3,3,1,5,8)]
SRA$COMMENTS="Observed F/(F+M)"
colnames(SRA)[4]="END_YEAR"
SRA
library(RDBprocessing)
